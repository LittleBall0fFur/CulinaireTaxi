@page
@model CompanyPageModel
@{
    Layout = null;

    var company = CompanyTable.RetrieveCompany(UserAgent.Account.CompanyId.Value);
    var companyName = company.Name;
}
<!DOCTYPE HTML>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />

    <link rel="stylesheet" href="~/css/index.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>

    <title>CulinaireTaxi | @companyName</title>
</head>
<body class="bg-primary">

    @* HEADER *@
    <div class="jumbotron text-shadow text-white">
        <nav class="navbar navbar-expand">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav m-auto">
                    <li class="nav-item border-right">
                        <a class="nav-link" href="/Portal/Logout">Logout</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/About">How to use</a>
                    </li>
                    <li class="nav-item border-left">
                        <a class="nav-link" href="/Contact">Contact</a>
                    </li>
                </ul>

            </div>
        </nav>

        <div>
            
            <a onclick="clickNotification()" class="notification" style="float:right; ">
                <span><img src="~/images/icons/notification_icon.png" onclick="clickNotification()" style="height: 30px; width:30px; padding-top:-50px;"></span>
                <span class="badge">3</span>
            </a>
        </div>

        <div class="container mx-auto mt-5">
            <div class="row">
                <div class="col text-center">
                    <h1 class="branding">Welcome @companyName</h1>
                    <p class="display-5">"Lorem Ipsum"</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <button class="btn btn-primary" type="button" onclick="alert('Why you no listen (ಥ﹏ಥ)')">DO NOT CLICK</button>
                </div>
            </div>
        </div>
    </div>

    @* MAIN CONTENT *@
    <div class="container">
        <div class="row">
            @* FIRST CARD *@
            <div class="col-sm pb-2">
                <div class="card shadow bg-secondary">
                    <div class="card-body">
                        <div class="calendar">
                            <div class="calendar_header">
                                <h5 class="header_copy">Reservation Calendar</h5>
                            </div>
                            <div class="calendar_plan">
                                <div class="cl_plan">
                                    <div class="cl_title" style="padding-left: 30px;">
                                        <form method="post">
                                            <input asp-for="PostID" type="hidden" value="@CompanyPageModel.POSTID_CALENDAR_TODAY" required />
                                            <input class="calendar_input" type="submit" value="Today" />
                                        </form>
                                    </div>
                                    <div class="cl_copy" style="padding-left: 45px;">@Model.GetDate().ToString("D")</div>
                                    <form method="post">
                                        <input asp-for="Date" type="hidden" value="@Model.Date" required>
                                        <input asp-for="PostID" type="hidden" value="@CompanyPageModel.POSTID_CALENDAR_BACKWARDS" required />

                                        <input class="calendar_input" type="submit" value="<" style="float:left; margin-left: -25px;" id="submit">
                                    </form>
                                    <form method="post">
                                        <input asp-for="Date" type="hidden" value="@Model.Date" required>
                                        <input asp-for="PostID" type="hidden" value="@CompanyPageModel.POSTID_CALENDAR_FORWARDS" required />

                                        <input class="calendar_input" type="submit" value=">" style="float:right; margin-right: -25px;" id="submit">
                                    </form>
                                </div>
                            </div>
                            <div class="calendar_events">
                                <p class="ce_title">Upcoming Events</p>
                                @foreach (Reservation reservation in ReservationTable.RetrieveReservationsFor(UserAgent.Account.CompanyId.Value, Model.GetDate()))
                                {
                                    if (reservation.Status != ReservationStatus.DECLINED)
                                    {
                                        <div class="event_item" onclick="clickRes('@AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.FullName', '@reservation.FromDate.ToString("HH:mm")', '@reservation.TillDate.ToString("HH:mm")', '@reservation.GuestsAmount', '@reservation.Status', '@reservation.Id')">
                                            <div class="ei_Dot dot_active"></div>
                                            <div class="ei_Title"><p id="time">@reservation.FromDate.ToString("HH:mm") -  @reservation.TillDate.ToString("HH:mm")</p></div>
                                            <div class="ei_Copy"><p>Name: @AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.FirstName @AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.LastName <br /> Amount of people: @reservation.GuestsAmount <br /> Status: @reservation.Status</p></div>
                                        </div>
                                        Model.AddReservation(reservation);
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            @* SECOND CARD *@
            <div class="col-sm pb-2">
                <div class="card shadow bg-secondary">
                    <div class="card-body">
                        <h5 class="header_copy">Taxi Companies</h5>
                        <form method="post">
                            <div class="input-group">
                                <select class="rounded-left" asp-for="ContractorID" required>
                                    @foreach (var taxiCompany in CompanyTable.RetrieveCompaniesOfType(CompanyType.TAXI))
                                    {
                                        <option value="@taxiCompany.Id">@taxiCompany.Name</option>
                                    }
                                </select>

                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="submit" name="PostID" value="@CompanyPageModel.POSTID_CONTRACTORS_ADD">Add</button>
                                </div>
                            </div>
                        </form>
                        <br />
                        <div>
                            @foreach (var contractor in ContractTable.RetrieveContractors(UserAgent.Account.CompanyId.Value))
                            {
                                <div class="mb-2 shadow-sm">
                                    <form method="post">
                                        <div class="input-group">
                                            <input asp-for="ContractorID" type="hidden" value="@contractor.Id" required />
                                            <input class="form-control rounded-left" type="text" value="@contractor.Name" readonly />

                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="submit" name="PostID" value="@CompanyPageModel.POSTID_CONTRACTORS_REMOVE">Remove</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            @* THIRD CARD *@
            <div class="col-sm pb-2">
                <div class="card shadow bg-secondary">
                    <div class="card-body">
                        <h5 class="header_copy">Cancelled Reservations</h5>
                        <div class="calendar_events">
                            @foreach (Reservation reservation in ReservationTable.RetrieveReservationsFor(UserAgent.Account.CompanyId.Value))
                            {
                                if (reservation.Status == ReservationStatus.DECLINED)
                                {
                                    <div class="event_item" onclick="clickRes('@AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.FullName', '@reservation.FromDate.ToString("HH:mm")', '@reservation.TillDate.ToString("HH:mm")', '@reservation.GuestsAmount', '@reservation.Status', '@reservation.Id')">
                                        <div class="ei_Dot dot_active"></div>
                                        <div class="ei_Title"><p id="time">@reservation.FromDate.ToString("D")</p></div>
                                        <p id="time">@reservation.FromDate.ToString("HH:mm") -  @reservation.TillDate.ToString("HH:mm")</p>
                                        <div class="ei_Copy"><p>Name: @AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.FirstName @AccountTable.RetrieveAccountByID(reservation.CustomerId).Contact.LastName <br /> Amount of people: @reservation.GuestsAmount <br /> Status: @reservation.Status</p></div>
                                    </div>
                                    Model.AddReservation(reservation);
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="ResPopUp" class="modal">
        <!-- Modal content -->
        <div class="modal-content shadow bg-secondary">
            <span class="close">&times;</span>
            <h5>Reservation</h5>
            <h6>Name:</h6>
            <p id="GuestName" style="padding-left: 30px;"></p>
            <h6>Amount of people:</h6>
            <p id="GuestAmount" style="padding-left: 30px;"></p>
            <h6>Time:</h6>
            <p id="Time" style="padding-left: 30px;"></p>
            <h6>Status:</h6>
            <p id="Status" style="padding-left: 30px;"></p>
            <form method="post">
                <input id="ResID" type="hidden" asp-for="ResID" value="" />
                <input asp-for="PostID" type="hidden" value="@CompanyPageModel.POSTID_CONFIRM_RESERVATION" required />
                <button class="btn btn-primary" id="Accept" type="submit" style="float:left; margin-bottom: -20px; width:20%;">Confirm</button>
            </form>
            <form method="post">
                <input id="ResID_Cancel" type="hidden" asp-for="ResID" value="" />
                <input asp-for="PostID" type="hidden" value="@CompanyPageModel.POSTID_DECLINE_RESERVATION" required />
                <button class="btn btn-primary" id="Cancel" type="submit" style="float:right; margin-top:-15px; width:20%;">Cancel</button>
            </form>
        </div>
    </div>

    <div id="NotificationPopUp" class="modal">
        <!-- Modal content -->
        <div class="modal-content shadow bg-secondary">
            <span class="close" id="Close">&times;</span>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script>
        // Get the modal
        var modal = document.getElementById('ResPopUp');

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        function clickRes(customerName, fromDate, tillDate, guestsAmount, status, resID) {
            $("#GuestName").text(customerName);
            $("#GuestAmount").text(guestsAmount);
            $("#Time").text(fromDate + " - " + tillDate);
            $("#Status").text(status);
            if (status == "ACCEPTED") {
                document.getElementById("Accept").disabled = true;
                document.getElementById("Cancel").disabled = false;
            }
            else {
                document.getElementById("Cancel").disabled = true;
                document.getElementById("Accept").disabled = false;
            }

            document.getElementById("ResID").value = resID;
            document.getElementById("ResID_Cancel").value = resID;

            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

    //Notification
    // Get the modal
        var popUp = document.getElementById('NotificationPopUp');

        // Get the <span> element that closes the modal
        var span2 = document.getElementById("Close");

        // When the user clicks the button, open the modal
        function clickNotification() {
            popUp.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span2.onclick = function () {
            popUp.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                popUp.style.display = "none";
            }
        }
    </script>

    <style>
        h6 {
            padding: 5px;
            font-size: 17px;
            color: #ccb7ae;
        }

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 10; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            width: 50%;
        }

        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            margin-left: 700px;
        }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }

        .notification {
          background-color: #555;
          color: white;
          text-decoration: none;
          padding: 15px 26px;
          position: relative;
          display: inline-block;
          border-radius: 2px;
        }

        .notification:hover {
          background: red;
        }

        .notification .badge {
          position: absolute;
          top: -10px;
          right: -10px;
          padding: 5px 10px;
          border-radius: 50%;
          background-color: red;
          color: white;
        }

        .calendar_input {
            margin-top: -80px;
            color: #d6cfcb;
            border: none;
            text-decoration: none;
            background-color: rgba(0, 0, 0, 0.00);
            font-size: 28px;
        }

        .calendar {
            width: 370px;
        }

        .header_copy {
            color: $light_grey;
            font-size: 20px;
        }

        .calendar_plan {
            margin: 20px 0 40px;
        }

        .cl_plan {
            height: 140px;
            background-color: #1da1a3;
            box-shadow: 0px 0px 52px -18px rgba(0, 0, 0, 0.75);
            padding: 30px;
            color: #fff;
            border-radius: 3px;
        }

        .cl_title {
        }

        .cl_copy {
            font-size: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        .cl_add {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #fff;
            cursor: pointer;
            margin: 0 0 0 65px;
            color: #c2c2c2;
            padding: 11px 13px;
        }

        .calendar_events {
            color: $light_grey;
        }

        .ce_title {
            font-size: 14px;
        }

        .event_item {
            margin: 18px 0;
            padding: 5px;
            cursor: pointer;
        }

        &:hover {
            background-image: linear-gradient(-222deg, #FF8494, #ffa9b7);
            box-shadow: 0px 0px 52px -18px rgba(0, 0, 0, 0.75);
        }

        .ei_Dot {
            background-color: #fff;
        }

        .ei_Copy, .ei_Title {
            color: #fff;
        }


        .ei_Dot, .ei_Title {
            display: inline-block;
        }

        .ei_Dot {
            border-radius: 50%;
            width: 10px;
            height: 10px;
            background-color: #1da1a3;
            box-shadow: 0px 0px 52px -18px rgba(0, 0, 0, 0.75);
        }

        .dot_active {
            background-color: #1da1a3;
        }

        .ei_Title {
            margin-left: 10px;
            color: #363b41;
        }

        .ei_Copy {
            font-size: 12px;
            margin-left: 27px;
        }

        .dark {
            background-image: linear-gradient(-222deg, #646464, #454545);
            color: #fff;
        }

        .header_title, .ei_Title, .ce_title {
            color: #fff;
        }
    </style>
</body>
</html>